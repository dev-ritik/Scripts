{% extends "base.html" %}
{% block title %}Status | Memory Aggregator{% endblock %}

{% block extra_style %}
<style>
    .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .provider-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        padding: 20px;
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .provider-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .provider-logo {
        width: 60px;
        height: 60px;
        object-fit: contain;
        margin-bottom: 10px;
    }

    .provider-name {
        font-size: 18px;
        font-weight: bold;
        color: #008069;
        margin-bottom: 6px;
        text-transform: capitalize;
    }

    .date-range {
        font-size: 13px;
        color: #555;
        margin-bottom: 8px;
    }

    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
    }

    .available {
        background-color: #e6f4ea;
        color: #1e7d34;
    }

    .unavailable {
        background-color: #fdecea;
        color: #c62828;
    }
</style>
{% endblock %}

{% block content %}
<h2>ðŸ“Š Provider Status</h2>
<p>Hereâ€™s an overview of all connected data providers and their availability.</p>

<div id="statusGrid" class="status-grid"></div>

<script>
    /**
     * Converts raw provider name â†’ title case without underscores
     */
    function formatName(name) {
        return name.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());
    }

    // Convert "Tue, 18 Nov 2025 00:00:00 GMT" â†’ "Nov 18, 2025"
    function formatDate(dateStr) {
        if (!dateStr) return null;

        const d = new Date(dateStr);
        if (isNaN(d)) return dateStr;  // fallback if invalid

        const options = {month: "short", day: "numeric", year: "numeric"};
        return d.toLocaleDateString("en-US", options);
    }

    function createProviderCard(name, info) {
        const card = document.createElement("div");
        card.className = "provider-card";

        const start = formatDate(info.start_date);
        const end = formatDate(info.end_date);

        const html = `
            <img src="${info.logo}" alt="${name} logo" class="provider-logo">

            <div class="provider-name">${formatName(name)}</div>

            <div class="date-range">
                ${start && end ? `${start} â†’ ${end}` : "No date range available"}
            </div>

            <div class="status-badge ${info.available ? "available" : "unavailable"}">
                ${info.available ? "Available" : "Unavailable"}
            </div>
        `;

        card.innerHTML = html;
        return card;
    }

    /**
     * Render all provider cards
     */
    async function renderProviders() {
        const container = document.getElementById("statusGrid");
        container.innerHTML = "";

        const res = await fetch("/status_data");
        providers = await res.json();

        Object.entries(providers).forEach(([name, info]) => {
            container.appendChild(createProviderCard(name, info));
        });
    }

    renderProviders();
</script>
{% endblock %}
